server {
    listen 80 default_server;
    listen [::]:80 default_server;
    gzip on;
    gzip_comp_level 6;
    gzip_vary on;
    gzip_types text/plain text/css application/json application/x-javascript application/javascript text/xml application/xml application/rss+xml text/javascript image/svg+xml application/vnd.ms-fontobject application/x-font-ttf font/opentype;
    root /usr/share/nginx/html/;
    server_tokens off;
    ssl_protocols TLSv1.2 TLSv1.3;

    # Add index.php to the list if you are using PHP
    index index.html index.htm index.nginx-debian.html;

    server_name _;

    # add_header Content-Security-Policy "frame-ancestors 'none'; form-action 'self'; default-src 'self'; script-src 'self'; style-src 'self';";
    # add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), fullscreen=(self)";


    # location / {
    #     root /usr/share/nginx/html/;
    #     index index.html;
    #     client_max_body_size 1024M;
    #     try_files $uri $uri/ /index.html;
    #     add_header X-Frame-Options "SAMEORIGIN" always;
    #     add_header Set-Cookie "Path=/; HttpOnly; Secure; SameSite=Strict";
    #     add_header Access-Control-Allow-Origin \"$http_origin\" always;
    #     add_header Strict-Transport-Security "max-age=86400; includeSubDomains; preload" always;
    #     add_header Referrer-Policy "strict-origin";
    #     add_header X-XSS-Protection "1; mode=block" always;
    #     add_header X-Content-Type-Options "nosniff" always;
    #     add_header Cache-Control "public, max-age=86400";
    #     add_header Expect-CT 'enforce, max-age=60';
    #     add_header hsts "True";
    #     add_header hsts-max-age "259200";
    #     add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), fullscreen=(self)";
    #     # add_header Content-Security-Policy "upgrade-insecure-requests; block-all-mixed-content";
    #     add_header Vary Origin;
    #     add_header Set-Cookie "Secure; HttpOnly; SameSite=None" always;
    # }
    location / {
        root /usr/share/nginx/html/;
        index index.html;
        client_max_body_size 1024M;
        try_files $uri $uri/ /index.html;
        add_header X-Frame-Options "SAMEORIGIN" always;
        # add_header Set-Cookie "Path=/; HttpOnly; Secure; SameSite=Strict";
        add_header Access-Control-Allow-Origin \"$http_origin\" always;
        add_header Access-Control-Max-Age "86400" always;
        add_header Strict-Transport-Security "max-age=86400; includeSubDomains; preload" always;
        add_header Referrer-Policy "strict-origin";
        add_header X-XSS-Protection "1; mode=block" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header Expect-CT 'enforce, max-age=60';
        add_header hsts "True";
        # add_header hsts-max-age "259200";
        add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), fullscreen=(self)";
        add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' unpkg.com maps.googleapis.com *.site24x7rum.in *.inadev.net *.infin8.io; worker-src 'self' blob: *.inadev.net *.infin8.io; style-src 'self' 'unsafe-inline' fonts.googleapis.com *.inadev.net *.infin8.io; font-src 'self' data: fonts.googleapis.com fonts.gstatic.com *.inadev.net *.infin8.io; connect-src 'self' maps.googleapis.com *.site24x7rum.in *.inadev.net *.infin8.io *.s3.amazonaws.com; img-src 'self' data: blob: maps.googleapis.com *.googleapis.com *.gstatic.com *.inadev.net *.infin8.io *.s3.amazonaws.com; frame-src 'self' data: about: blob: *.inadev.net *.infin8.io *.s3.amazonaws.com; media-src 'self' *.inadev.net *.infin8.io *.s3.amazonaws.com; manifest-src 'self' *.inadev.net *.infin8.io; child-src 'self' *.inadev.net *.infin8.io; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'self' *.inadev.net *.infin8.io; upgrade-insecure-requests;" always;
        add_header Vary Origin;
    }

    # Cache control for index.html - Always fetch fresh
    location = /index.html {
        root /usr/share/nginx/html/;
        add_header Cache-Control "no-store, no-cache, must-revalidate, max-age=0" always;
        add_header Pragma "no-cache" always;
        add_header Expires "0" always;
        add_header X-Frame-Options "SAMEORIGIN" always;
        # add_header Set-Cookie "Path=/; HttpOnly; Secure; SameSite=Strict";
        add_header Access-Control-Allow-Origin \"$http_origin\" always;
        add_header Access-Control-Max-Age "86400" always;
        add_header Strict-Transport-Security "max-age=86400; includeSubDomains; preload" always;
        add_header Referrer-Policy "strict-origin";
        add_header X-XSS-Protection "1; mode=block" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header Expect-CT 'enforce, max-age=60';
        add_header hsts "True";
        # add_header hsts-max-age "259200";
        add_header Permissions-Policy "geolocation=(), microphone=(), camera=(), fullscreen=(self)";
        add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' unpkg.com maps.googleapis.com *.site24x7rum.in *.inadev.net *.infin8.io; worker-src 'self' blob: *.inadev.net *.infin8.io; style-src 'self' 'unsafe-inline' fonts.googleapis.com *.inadev.net *.infin8.io; font-src 'self' data: fonts.googleapis.com fonts.gstatic.com *.inadev.net *.infin8.io; connect-src 'self' maps.googleapis.com *.site24x7rum.in *.inadev.net *.infin8.io *.s3.amazonaws.com; img-src 'self' data: blob: maps.googleapis.com *.googleapis.com *.gstatic.com *.inadev.net *.infin8.io *.s3.amazonaws.com; frame-src 'self' data: about: blob: *.inadev.net *.infin8.io *.s3.amazonaws.com; media-src 'self' *.inadev.net *.infin8.io *.s3.amazonaws.com; manifest-src 'self' *.inadev.net *.infin8.io; child-src 'self' *.inadev.net *.infin8.io; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'self' *.inadev.net *.infin8.io; upgrade-insecure-requests;" always;
        add_header Vary Origin;
    }

    # Cache control for hashed assets (JS, CSS with hashes) - Cache for 1 year
    location ~* \.(js|css)$ {
        root /usr/share/nginx/html/;
        add_header Cache-Control "public, max-age=31536000, immutable" always;
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header Access-Control-Allow-Origin \"$http_origin\" always;
        add_header Access-Control-Max-Age "86400" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header Strict-Transport-Security "max-age=86400; includeSubDomains; preload" always;
        add_header Vary Origin;
        # add_header Set-Cookie "Secure; HttpOnly; SameSite=Lax" always;
    }

    # Cache control for other assets (images, fonts, etc.) - Cache for 30 days
    location ~* \.(png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        root /usr/share/nginx/html/;
        add_header Cache-Control "public, max-age=2592000" always;
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header Access-Control-Allow-Origin \"$http_origin\" always;
        add_header Access-Control-Max-Age "86400" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header Strict-Transport-Security "max-age=86400; includeSubDomains; preload" always;
        add_header Vary Origin;
        # add_header Set-Cookie "Secure; HttpOnly; SameSite=Lax" always;
    }

}